language: php

services:
- mysql
- docker

php:
  - 7.3

matrix:
  include:
    - python: 'pypy'
    - python: 'pypy3'
    - python: 'pypy2.7-7.0'
    - python: 'pypy3-7'
    - python: 'pypy3-7.0'
    - python: 'pypy3-7.1'
    - python: 'pypy3.5-7.0'
    - python: 'pypy3.6-7'
    - python: 'pypy3.6-7.0'
    - python: 'pypy3.6-7.1'
    - python: 'pypy2.7-6.0'
    - python: 'pypy3.5-6.0'
    - python: '3.7'
    - python: '3.6'
    - python: '3.5'
    - python: '2.7'
    - python: 'nightly'
    - python: '3.7-dev'
    - python: '3.6-dev'

stage: "Test"
name: "Primary tests"
install:
  - echo "Primary tests"
  - echo install
  - echo install
  - echo install

script:
  - echo "Primary tests"
  - echo script
  - echo script
  - echo script
  - echo script
  - echo script
  - echo script
  - echo script
  - echo script
  - echo script
  - echo script
  - echo script
  - echo script
  - echo script

after_success:
  - echo "Primary tests"
  - echo after_success
  - echo after_success
  - echo after_success
  - echo after_success
  - echo after_success
  - echo after_success
  - echo after_success
  - echo after_success
  - echo after_success

jobs:
  include:
    - stage: "Test"
      name: "Secondary tests"
      install:
        - echo "Secondary tests"
        - echo install

      script:
        - echo "Secondary tests"
        - echo script
        - echo script
        - echo script

      after_success:
        # Don't inherit global after_success
        - echo ""

    - stage: "Docker build & push"
      name: "Build & publish Docker images"
      before_install:
        - echo "Build & publish Docker images"
        - echo before_install
        - echo before_install
        - echo before_install

      script:
        - echo "Build & publish Docker images"
        - echo script
        - echo script
